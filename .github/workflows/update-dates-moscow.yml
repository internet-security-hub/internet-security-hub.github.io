name: Update Dates Daily Moscow Time
on:
  schedule:
    - cron: '0 22 * * *'  # 22:00 UTC = 01:00 MSK (UTC+3)
  workflow_dispatch:  # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  update-dates:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Set Moscow timezone and update dates
        run: |
          # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ—Å–∫–æ–≤—Å–∫—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É
          export TZ='Europe/Moscow'
          
          # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–π –∑–æ–Ω–µ
          MOSCOW_DATE=$(TZ=Europe/Moscow date +"%Y-%m-%d")
          MOSCOW_DATETIME=$(TZ=Europe/Moscow date +"%Y-%m-%dT01:00:00+03:00")
          MOSCOW_SITEMAP_DATE=$(TZ=Europe/Moscow date +"%Y-%m-%d")
          
          echo "Updating to Moscow date: $MOSCOW_DATE"
          echo "Updating to Moscow datetime: $MOSCOW_DATETIME"
          
          # –û–±–Ω–æ–≤–∏—Ç—å article:modified_time –≤–æ –≤—Å–µ—Ö HTML —Ñ–∞–π–ª–∞—Ö
          find . -name "*.html" -type f -exec sed -i "s/<meta property=\"article:modified_time\" content=\"[^\"]*\"/<meta property=\"article:modified_time\" content=\"$MOSCOW_DATETIME\"/g" {} \;
          
          # –û–±–Ω–æ–≤–∏—Ç—å dateModified –≤ JSON-LD Schema
          find . -name "*.html" -type f -exec sed -i "s/\"dateModified\": \"[^\"]*\"/\"dateModified\": \"$MOSCOW_DATE\"/g" {} \;
          
          # –û–±–Ω–æ–≤–∏—Ç—å lastmod –≤ sitemap.xml
          if [ -f "sitemap.xml" ]; then
            sed -i "s/<lastmod>[^<]*<\/lastmod>/<lastmod>$MOSCOW_SITEMAP_DATE<\/lastmod>/g" sitemap.xml
          fi
          
          # –û–±–Ω–æ–≤–∏—Ç—å –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
          find . -name "*.html" -type f -exec sed -i "s/\"datePublished\": \"2025-08-[0-9][0-9]\"/\"datePublished\": \"$MOSCOW_DATE\"/g" {} \;
          
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add -A
          
          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if ! git diff --staged --quiet; then
            MOSCOW_TIME=$(TZ=Europe/Moscow date +"%Y-%m-%d %H:%M MSK")
            git commit -m "ü§ñ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç: $MOSCOW_TIME"
            git push
            echo "Dates updated successfully at $MOSCOW_TIME"
          else
            echo "No changes to commit"
          fi
